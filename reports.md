# Report Generation Strategy

This document outlines the current state, desired functionality, and implementation plan for generating periodic progress reports (Weekly, Monthly, Quarterly) for the TechDeck Academy.

## Current State

- **Generation Mechanism:** Reports are currently generated by the GitHub Actions workflow defined in `.github/workflows/generate-digests.yml`.
- **Scheduling:** The workflow runs automatically on a schedule (Weekly, Monthly, Quarterly) and can be triggered manually.
- **Output:** Markdown files are generated and saved to `progress/weekly/`, `progress/monthly/`, or `progress/quarterly/` directories within the repository.
- **Content Generation:**
    - **AI Summary:** A narrative summary is generated using the `generateDigestSummary` function in `src/utils/ai.ts`. This function uses `ai-memory.md` as input and *is* aware of the requested report period (`weekly`, `monthly`, `quarterly`), tailoring its output accordingly.
    - **Statistics Section:** This section is generated via `node -e` commands directly within the workflow YAML. It calls functions from `src/utils/stats-manager.js` and `src/utils/profile-manager.js` to fetch *overall* statistics (total challenges completed, overall average score, current skill level, activity streaks, etc.).
- **Major Flaw:** The statistics section **does not differentiate** based on the reporting period. A weekly report shows the same overall statistics as a monthly or quarterly report, failing to provide period-specific insights or appropriate levels of summarization.
- **Data Sources Used:** `ai-memory.md`, `stats.json` (overall view), `student-profile.json` (overall view).
- **Emailing:** Code for formatting digest emails exists (`src/utils/email.ts`) but is not currently integrated into the `generate-digests.yml` workflow.

## Expected State / Requirements

The goal is to generate meaningful, period-specific progress reports that provide insights similar to what a human teacher or mentor would offer.

- **Report Types:** Weekly, Monthly, Quarterly.
- **Content Differentiation & Data Sources:** Each report type must have distinct content and granularity:
    - **Weekly Report:**
        - **Focus:** Recent activity and immediate next steps.
        - **Content:**
            - AI Summary (period='weekly', from `ai-memory.md`).
            - Activity Summary: Challenges attempted/completed *this week*, scores achieved, letters exchanged. (Data: Filtered `stats.json`, `submissions/`, `feedback/`, `letters/`).
            - Observed Strengths/Weaknesses: Based on *recent* `feedback/` entries and insights from `letters/`.
            - Suggested Focus for Next Week: Specific, actionable steps.
    - **Monthly Report:**
        - **Focus:** Summarizing the month's progress, identifying trends, and setting broader goals.
        - **Content:**
            - AI Summary (period='monthly', from `ai-memory.md`, potentially referencing weekly summaries).
            - Monthly Overview: Aggregation of weekly activity/stats, trends in scores/topics. (Data: Aggregated weekly reports/`stats.json` for the month).
            - Topic Progress: Analysis of progress within specific topics during the month. (Data: `stats.json`, `student-profile.json`).
            - Recurring Themes: Patterns observed across weekly reports, feedback, and letters.
            - Goals for Next Month: Learning objectives and focus areas.
    - **Quarterly Report:**
        - **Focus:** High-level review of the past quarter, long-term trends, and strategic planning.
        - **Content:**
            - AI Summary (period='quarterly', from `ai-memory.md`, potentially referencing monthly summaries).
            - Quarterly Review: Aggregation of monthly reports/stats, major milestones, skill level changes. (Data: Aggregated monthly reports/`stats.json` for the quarter, `student-profile.json`).
            - Long-Term Trends: Analysis of progress, consistency, and challenges over the 3 months.
            - Strategic Goals: High-level objectives for the next quarter.

- **Archiving Interaction:**
    - The report generation process must be aware of the file archiving performed by the `.github/workflows/rotate-files.yml` workflow.
    - Reports should primarily analyze data from *active* directories (`challenges/`, `submissions/`, `feedback/`, `letters/`).
    - For longer-term trends (especially in Monthly/Quarterly reports), the process must leverage the aggregated historical data retained in `stats.json` (e.g., weekly/monthly summaries) which persists even after individual files are moved to `archive/`.
    - Ensure the `stats-manager.ts` aggregation logic (`aggregateOldEntries`) correctly preserves the necessary summary data before raw files are archived.

## Proposed Implementation Plan

1.  **Create New Utility:** Develop a dedicated module `src/utils/report-generator.ts`.
2.  **Implement Report Functions:** Define and implement asynchronous functions within the new module:
    - `generateWeeklyReport(startDate: string, endDate: string): Promise<string>`
    - `generateMonthlyReport(startDate: string, endDate: string): Promise<string>`
    - `generateQuarterlyReport(startDate: string, endDate: string): Promise<string>`
    - These functions will be responsible for:
        - Fetching data from all relevant sources (`stats.json`, `student-profile.json`, `ai-memory.md`, active data files, potentially prior period report files).
        - Performing period-specific filtering and aggregation of data.
        - Calling `ai.ts#generateDigestSummary` with the appropriate period type.
        - Formatting the complete report content into a Markdown string (potentially using the `ProgressReport` type from `src/types.ts` as an internal structure).
3.  **Refactor GitHub Workflow (`.github/workflows/generate-digests.yml`):**
    - Remove the existing `node -e` commands used for generating the statistics section.
    - Add a build step (`npm run build`) if not already present before the generation step.
    - Add a new step that calls the appropriate `generate[Period]Report` function from the compiled output (e.g., `./dist/utils/report-generator.js`) based on the determined `DIGEST_TYPE`.
    - Capture the string output from the function.
    - Write the captured string to the correct Markdown file in the `progress/` directory.
4.  **(Optional Enhancement):** Integrate the `src/utils/email.ts` functionality into the workflow to email the generated reports.

This approach centralizes the complex report generation logic in maintainable TypeScript code, ensures reports are period-specific and insightful, and correctly handles data interaction with the archiving process. 